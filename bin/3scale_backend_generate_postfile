#! /usr/bin/env ruby

require 'optparse'
require 'digest/md5'

transactions_count = 0
provider_key       = nil
user_keys          = []

parser = OptionParser.new do |parser|
  parser.on('-t', '--transactions NUMBER', 'Number of transactions in the postfile.') do |value|
    transactions_count = value.to_i
  end

  parser.on('-p', '--provider-key KEY', 'Provider key') do |value|
    provider_key = value
  end

  parser.on('-u', '--user-keys KEYS', 'List of user keys (separated by commas)') do |values|
    user_keys = values.split(/\s*,\s*/)
  end

  parser.parse!
end

abort "Provider key is required" unless provider_key
abort "At least one user key is required" unless user_keys.size > 0

transactions_count = 1 if transactions_count < 1

output = ''
output << "provider_key=#{provider_key}"

transactions_count.times do |index|
  output << "&transactions[#{index}][user_key]=#{user_keys[index % user_keys.size]}"
  output << "&transactions[#{index}][usage][hits]=1"
end

puts output
