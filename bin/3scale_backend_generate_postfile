#! /usr/bin/env ruby

require 'optparse'
require 'digest/md5'

transactions_count = 0
provider_key       = nil
app_ids            = []

parser = OptionParser.new do |parser|
  parser.on('-t', '--transactions NUMBER', 'Number of transactions in the postfile.') do |value|
    transactions_count = value.to_i
  end

  parser.on('-p', '--provider-key KEY', 'Provider key') do |value|
    provider_key = value
  end

  parser.on('-a', '--app_ids IDS', 'List of application ids (separated by commas)') do |values|
    app_ids = values.split(/\s*,\s*/)
  end

  parser.parse!
end

abort "Provider key is required" unless provider_key
abort "At least one app id is required" unless app_ids.size > 0

transactions_count = 1 if transactions_count < 1

output = ''
output << "provider_key=#{provider_key}"

transactions_count.times do |index|
  output << "&transactions[#{index}][app_id]=#{app_ids[index % app_ids.size]}"
  output << "&transactions[#{index}][usage][hits]=1"
end

puts output
